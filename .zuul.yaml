---
- project:
    templates:
      - build-openstack-docs-pti
    check:
      jobs:
        - build-openstack-api-ref
        - build-openstack-releasenotes
        - openstack-tox-pep8
        - openstack-tox-linters
        - stx-devstack-ha:
            voting: false
    gate:
      jobs:
        - build-openstack-api-ref
        - build-openstack-releasenotes
        - openstack-tox-pep8
        - openstack-tox-linters
    post:
      jobs:
        - publish-stx-api-ref
        - publish-stx-tox
        - publish-stx-releasenotes

- job:
    name: stx-devstack-ha
    parent: stx-devstack-base
    timeout: 7800
    required-projects:
      - openstack/stx-config
      - openstack/stx-fault
      - openstack/stx-metal
      - openstack/stx-update
    vars:
      tox_envlist: functional
      devstack_services:
        horizon: false
        # StarlingX services
        fm-common: true
        fm-api: true
        sm-common: true
        sm-db: true
        sm-daemon: true
        sm-client: true
        sm-tools: true
        sm-api: true
        mysql: false
        postgresql: true
        tls-proxy: false
      devstack_plugins:
        stx-ha: git://git.starlingx.io/stx-ha
        stx-metal: git://git.starlingx.io/stx-metal
        stx-config: git://git.starlingx.io/stx-config
        stx-fault: git://git.starlingx.io/stx-fault
        stx-update: git://git.starlingx.io/stx-update
    files:
      - ^devstack/.*
